Critical pkg 

zypper in -y nfs-client nfs-kernel-server xfsprogs ceph-common open-iscsi cloud-init clone-master-clean-up
systemctl enable cloud-init-local.service && systemctl enable cloud-init.service && systemctl enable cloud-config.service && systemctl enable cloud-final.service
#sometimes the service needs to be reinstalled or restarted
systemctl enable --now docker

sysctl net.ipv4.conf.all.forwarding=1
sysctl net.ipv6.conf.all.forwarding=1

vi /etc/ssh/sshd_config
PubkeyAuthentication yes
AllowTcpForwarding yes

vi /etc/sysctl.conf
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
net.ipv4.ip_forward = 1

vi /etc/sysctl.d/90-rancher.conf
net.ipv4.conf.all.forwarding=1
net.ipv6.conf.all.forwarding=1
net.bridge.bridge-nf-call-iptables=1

vi /etc/modules-load.d/modules-rancher.conf 
br_netfilter
ip6_udp_tunnel
ip_set_hash_ip
ip_set_hash_net
iptable_filter
iptable_nat
iptable_mangle
iptable_raw
nf_conntrack_netlink
nf_conntrack
nf_conntrack_ipv4
nf_defrag_ipv4
nf_nat
nf_nat_ipv4
nf_nat_masquerade_ipv4
udp_tunnel
veth
vxlan
xt_addrtype
xt_conntrack
xt_comment
xt_mark
xt_multiport
xt_nat
xt_recent
xt_set
xt_statistic
xt_tcpudp

clone-master-clean-up

for single server cluster
curl -sfL https://get.k3s.io | sh -s - server
for HA cluster:
curl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=v1.23.8+k3s2 sh -s - server --cluster-init
join server to HA cluster
curl -sfL https://get.k3s.io | K3S_TOKEN=SECRET sh -s - server --server https://<ip or hostname of server1>:6443
join worker nodes to cluster
curl -sfL https://get.k3s.io | K3S_URL=https://<ip or hostname of server1>:6443  K3S_TOKEN=SECRET sh -

To uninstall K3s from a server node, run:
/usr/local/bin/k3s-uninstall.sh
To uninstall K3s from an agent node, run:
/usr/local/bin/k3s-agent-uninstall.sh

helm repo add jetstack https://charts.jetstack.io
helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
helm repo update

helm install cert-manager jetstack/cert-manager \
--create-namespace \
--namespace cert-manager \
--version v1.7.1 \
--set installCRDs=true \
--set nodeSelector."kubernetes\.io/os"=linux \
--set webhook.nodeSelector."kubernetes\.io/os"=linux \
--set cainjector.nodeSelector."kubernetes\.io/os"=linux \
--set startupapicheck.nodeSelector."kubernetes\.io/os"=linux
  
  
helm install rancher rancher-latest/rancher \
--create-namespace \
--namespace cattle-system \
--set hostname=<IP_OF_LINUX_NODE>.sslip.io \
--set replicas=3 \
--set bootstrapPassword=<PASSWORD_FOR_RANCHER_ADMIN>
